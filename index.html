<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>QR-Reader (7.2.5)</title>
  <meta name="theme-color" content="#0f172a"/>
  <meta name="color-scheme" content="dark light"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" type="image/png" sizes="1x1" href="icons/icon-192.png"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
      <div>
        <h1>QR-Reader</h1>
        <div class="subtitle">v7.2.5 — fix object literal syntax; OCR via Tesseract.recognize; BD→jsQR fallback intact</div>
      </div>
      <div style="display:flex;gap:8px;min-width:520px;flex-wrap:wrap;justify-content:flex-end">
        <span id="scanEngine" class="pill">Engine: Detecting…</span>
        <span id="ocrStatus" class="pill">OCR: Off</span>
        <button id="installBtn" type="button" class="secondary" style="display:none">Install App</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="androidBanner" class="banner" style="display:none"></div>
    <div id="toast" role="status" aria-live="polite"></div>

    <div class="grid">
      <section class="card"><div class="content">
        <h2 style="margin:0 0 10px 0">Scanner</h2>

        <div class="controls row" style="margin-bottom:8px">
          <label class="sr-only" for="cameraSource">Camera source</label>
          <select id="cameraSource" title="Camera source" class="tight">
            <option value="local" selected>Local camera</option>
            <option value="remote">Remote camera (WebRTC)</option>
            <option value="serial">Phone via Serial/Bluetooth</option>
          </select>
          <button id="remoteHostBtn" type="button" class="secondary">Create Session</button>
          <input id="remoteCodeInput" class="tight" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter code to join" title="Pairing code"/>
          <button id="remoteJoinBtn" type="button" class="secondary">Join</button>
        </div>

        <div class="controls row" style="margin-bottom:8px">
          <button id="connectSerial" type="button" class="secondary" title="Connect phone via Bluetooth/Serial (Windows COM port)">Connect Phone (Serial)</button>
          <span id="serialState" class="muted"></span>
        </div>

        <div class="video-wrap">
          <video id="video" playsinline webkit-playsinline muted></video>
          <canvas id="overlay"></canvas>
        </div>

        <div class="legend" style="margin-top:6px">
          <span class="dot" style="background:#8b8b8b"></span> ROI active & no text |
          <span class="dot" style="background:#22c55e"></span> OCR text detected
        </div>

        <div class="controls row" style="margin-top:12px">
          <button id="permBtn" type="button" class="secondary">Request Permission</button>
          <button id="startBtn" type="button" class="primary">Start Camera</button>
          <button id="stopBtn" type="button" class="secondary">Stop</button>
          <button id="testOCR" type="button" class="secondary" title="Run one recognition now">Test OCR</button>
        </div>

        <div class="controls row" style="margin-top:8px">
          <label class="sr-only" for="cameraSelect">Camera</label>
          <select id="cameraSelect" title="Camera" aria-label="Camera device list" class="tight"></select>
          <button id="refreshBtn" type="button" class="secondary" title="Refresh">Refresh</button>
          <label class="sr-only" for="prefFacing">Preferred camera</label>
          <select id="prefFacing" title="Preferred camera" aria-label="Preferred camera" class="tight">
            <option value="environment">Prefer Back</option>
            <option value="user">Prefer Front</option>
            <option value="auto" selected>Auto</option>
          </select>
        </div>

        <div class="controls row" style="margin-top:8px">
          <label class="sr-only" for="scaleMode">Scale source</label>
          <select id="scaleMode" title="Scale source" class="tight">
            <option value="none">No scale</option>
            <option value="ocr">OCR from camera</option>
            <option value="hid">USB/HID scale</option>
            <option value="ble">Bluetooth scale</option>
          </select>
          <label class="sr-only" for="delaySec">Scale delay seconds</label>
          <input id="delaySec" type="number" min="0" max="4" step="0.1" value="2" title="Delay (seconds)" class="tight"/>
          <button id="connectHID" type="button" class="secondary">Connect USB/HID</button>
          <button id="connectBLE" type="button" class="secondary">Connect BLE</button>
          <button id="ocrToggle" type="button" class="secondary">Toggle OCR Box</button>
        </div>

        <div class="controls row" style="margin-top:8px">
          <label for="cooldownSec">Post‑scan pause (s)</label>
          <input id="cooldownSec" class="tight" type="number" min="0" max="10" step="0.5" value="5"/>
          <label><input id="ignoreDup" type="checkbox" checked/> Ignore duplicates</label>
          <button id="resetDup" type="button" class="secondary">Reset duplicates</button>
        </div>

        <div class="controls row" style="margin-top:8px">
          <label class="sr-only" for="manualInput">Manual entry</label>
          <input id="manualInput" type="text" placeholder="Manual or keyboard scanner input (press Enter)"/>
          <button id="addManualBtn" type="button">Add</button>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>
        <div id="remoteStatus" class="muted" style="margin-top:4px"></div>
        <div id="permState" class="muted" style="margin-top:4px"></div>
      </div></section>

      <section class="card"><div class="content">
        <h2 style="margin:0 0 10px 0">Log</h2>
        <div class="controls" style="margin-bottom:8px">
          <button id="exportXlsx" type="button" class="primary">Export Excel (.xlsx)</button>
          <button id="exportCsv" type="button" class="secondary">Export CSV</button>
          <button id="exportZip" type="button" class="secondary">Export ZIP (CSV+Photos)</button>
          <button id="importFileBtn" type="button" class="secondary" aria-controls="fileInput">Import (CSV+XLSX)</button>
          <label for="fileInput" class="sr-only">Choose file to import</label>
          <input id="fileInput" type="file" accept=".csv, .xlsx, .xls" title="Choose file" aria-label="Choose file" style="display:none"/>
          <button id="clearBtn" type="button" class="secondary" title="Clear all rows">Clear</button>
        </div>
        <div class="card" style="max-height:55vh;overflow:auto">
          <table id="logTable">
            <thead><tr>
              <th>#</th><th>Content</th><th>Format</th><th>Source</th><th>Date</th><th>Time</th><th>Weight (g)</th><th>Photo</th><th>Count</th><th>Notes</th><th>Actions</th>
            </tr></thead>
            <tbody id="logBody"></tbody>
          </table>
        </div>
      </div></section>
    </div>
  </main>

  <script src="app.js"></script>
  <script type="module" src="remote.js"></script>
</body>
</html>
